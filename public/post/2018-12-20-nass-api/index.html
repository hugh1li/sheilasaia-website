<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.39" />
  <meta name="author" content="sheila m. saia, PhD">

  
  
  
  
    
      
    
  
  <meta name="description" content="Background Application program interfaces (APIs) help users access (“API request”) and retreive (“API reponse”) data from a web-based, data server via programs like R. Several others before me have done a great job writing about API’s and R: this post by C. Waldhauser and this post by T. Clavelle.
I recently learned about a few packages to help R users interface directly with APIs that are relevant to water-minded, data loving people like me.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2018-12-20-nass-api/">

  


  

  
  
  <meta name="theme-color" content="#3f51b5">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
  <link rel="stylesheet" href="/css/github.css" rel="stylesheet" id="theme-stylesheet">
  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title=" ">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title=" ">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2018-12-20-nass-api/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@sheilasaia">
  <meta property="twitter:creator" content="@sheilasaia">
  
  <meta property="og:site_name" content=" ">
  <meta property="og:url" content="/post/2018-12-20-nass-api/">
  <meta property="og:title" content="APIs to the Rescue (&amp; the Census of Agriculture) |  ">
  <meta property="og:description" content="Background Application program interfaces (APIs) help users access (“API request”) and retreive (“API reponse”) data from a web-based, data server via programs like R. Several others before me have done a great job writing about API’s and R: this post by C. Waldhauser and this post by T. Clavelle.
I recently learned about a few packages to help R users interface directly with APIs that are relevant to water-minded, data loving people like me.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-12-30T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-12-30T00:00:00&#43;00:00">
  

  
  

  <title>APIs to the Rescue (&amp; the Census of Agriculture) |  </title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/"> </a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>wateR blog</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>talks</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">APIs to the Rescue (&amp; the Census of Agriculture)</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-12-30 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Dec 30, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="sheila m. saia, PhD">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r/">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=APIs%20to%20the%20Rescue%20%28%26%20the%20Census%20of%20Agriculture%29&amp;url=%2fpost%2f2018-12-20-nass-api%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2018-12-20-nass-api%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2018-12-20-nass-api%2f&amp;title=APIs%20to%20the%20Rescue%20%28%26%20the%20Census%20of%20Agriculture%29"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2018-12-20-nass-api%2f&amp;title=APIs%20to%20the%20Rescue%20%28%26%20the%20Census%20of%20Agriculture%29"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=APIs%20to%20the%20Rescue%20%28%26%20the%20Census%20of%20Agriculture%29&amp;body=%2fpost%2f2018-12-20-nass-api%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="background" class="section level1">
<h1>Background</h1>
<p>Application program interfaces (APIs) help users access (“API request”) and retreive (“API reponse”) data from a web-based, data server via programs like R. Several others before me have done a great job writing about API’s and R: <a href="https://www.r-bloggers.com/accessing-apis-from-r-and-a-little-r-programming/">this post by C. Waldhauser</a> and <a href="https://tclavelle.github.io/blog/r_and_apis/">this post by T. Clavelle</a>.</p>
<p>I recently learned about a few packages to help R users interface directly with APIs that are relevant to water-minded, data loving people like me. For example the <a href="https://walkerke.github.io/tidycensus/"><code>tidycensus</code> package</a> developed by <a href="http://personal.tcu.edu/kylewalker/">Kyle Walker</a> allows R users to access the US Census API and download data directly into their R environment. It’s awesome. Additionally, <a href="https://sheilasaia.rbind.io/post/2018-08-04-usgs-rollify/">I previously wrote about</a> the US Geologic Survey and US Environmental Protection Agency’s <a href="https://cran.r-project.org/web/packages/dataRetrieval/dataRetrieval.pdf"><code>dataRetrieval</code> package</a> that interfaces with the National Water Information System API. Some APIs will require you to have an API key (i.e., the US Census) while others don’t (i.e., the National Water Information System). The key is meant to ensure security on your end as well as on the end of the API administrator. In the case of the US Census, they can keep track of your queries and also make sure that you have permission to access certain types of data, etc. You can easily request an US Census API key <a href="https://api.census.gov/data/key_signup.html">here</a> and read more about the US Census API <a href="https://www.census.gov/data/developers/guidance/api-user-guide.html">here</a>.</p>
<p>But what if you’re working with an API that doesn’t already have an R package associated with it? This is the case for the data associated with the US Department of Agriculture National Agricultural Statistics Service (NASS). I could click through the options on NASS’s Quick Stats page <a href="https://quickstats.nass.usda.gov/">on the web</a> and download the data that way; however, I wanted to see if I could use R to access the Quick Stats API (i.e., a more reproducible approach).</p>
<p>Before jumping into the coding fun, just a brief explainer on the NASS API. The NASS API includes two different types of data:</p>
<ol style="list-style-type: decimal">
<li>NASS Agriculture Resource Management Survey (ARMS) - This survey includes data on the “production practices, resource use, and economic well-being of America’s farms and ranches” <a href="https://www.nass.usda.gov/Surveys/Guide_to_NASS_Surveys/Ag_Resource_Management/">(NASS ARMS Webiste)</a>.</li>
<li>NASS Census of Agriculture - This survey is conducted every 5 years and includes data on the number of US farms and ranches and the people who operate them (as long as more than $1000 was raised from associated agricultural goods). It also includes data on land use, land ownership, production practices, income, and expenses <a href="https://www.nass.usda.gov/AgCensus/index.php">(NASS Census of Agriculture Website)</a>.</li>
</ol>
</div>
<div id="goals-of-this-post" class="section level1">
<h1>Goals of This Post</h1>
<p>The main goal of this blog post is to:</p>
<ul>
<li>Download and plot Agrilture Census data from NASS Quick Stats using R.</li>
</ul>
<p>Special thanks to <a href="http://nelson.rbind.io/">Natalie Nelson</a> of NC State University and Andrew Dau of NASS for the inspiration and R code samples that I modified for this post.</p>
</div>
<div id="set-up" class="section level1">
<h1>Set Up</h1>
<p>First let’s load the R libraries that we’ll need to run the code in this post.</p>
<pre class="r"><code>library(httr)
library(jsonlite)
library(tidycensus)
library(tidyverse)
library(mapview)</code></pre>
<p>The <code>httr</code> and <code>jsonlite</code> packages are necessary for interfacing with the Quick Stats API and reformatting API outputs so they can be used in R.</p>
<p>Let’s use the <code>tidycensus</code> package to get some county boundaries. This will provide some spatial context for our analysis.</p>
<p>The <code>tidyverse</code> and <code>mapview</code> packages will help us wrangle and visualize the API outputs.</p>
<pre class="r"><code># If you have never used your API key in your R session, run the line below.
census_api_key(&quot;YOUR API KEY GOES HERE&quot;)</code></pre>
<pre class="r"><code># If you have used your API key in a previous R session, run the line below.
options(tigris_use_cache = TRUE)</code></pre>
<p>You’ll have to also apply for a NASS API key. We’ll use this later but will definite it here as a string. You can apply for a NASS API key <a href="https://quickstats.nass.usda.gov/api">here</a></p>
<pre class="r"><code>my_nass_key &lt;- &quot;ADD YOUR NASS API KEY HERE&quot;</code></pre>
<p>Now, we’ll define the NASS url and path. In the path you’ll have to specify what type of data you want to query. To specify these you can go to <a href="https://quickstats.nass.usda.gov/" class="uri">https://quickstats.nass.usda.gov/</a> to see all your commodity options. I haven’t figured out another way to do this but please <a href="mailto:ssaia@ncsu.edu">contact me</a> if you find an alternative.</p>
<p>For this post I’m selecting the “AG_LAND” commodity, which includes information on the acreage of irrigated farm and ranch lands, because this is the wateR blog after all. I’m also selecting the state of North Carolina because it seems to always be the subject of spatial mapping <a href="https://r-spatial.github.io/sf/reference/geos_combine.html">(e.g., see this post)</a> in R and is also where I live. ;) You can also leave off the last “&amp;state_alpha=NC” part of the string to get data from all states.</p>
<pre class="r"><code># NASS url
nass_url &lt;- &quot;http://quickstats.nass.usda.gov&quot;

# commodity description of interest
my_commodity_desc &lt;- &quot;AG LAND&quot;

# query start year
my_year &lt;- &quot;2006&quot;

# state of interest
my_state &lt;- &quot;NC&quot;

# final path string
path_nc_ag_land &lt;- paste0(&quot;api/api_GET/?key=&quot;, my_nass_key, &quot;&amp;commodity_desc=&quot;, my_commodity_desc, &quot;&amp;year__GE=&quot;, my_year, &quot;&amp;state_alpha=&quot;, my_state)

# check
path_nc_ag_land
## [1] &quot;api/api_GET/?key=9BCD166E-39D9-3A6A-9BF9-4317FCC1E606&amp;commodity_desc=AG LAND&amp;year__GE=2006&amp;state_alpha=NC&quot;</code></pre>
</div>
<div id="api-data-query" class="section level1">
<h1>API Data Query</h1>
<p>Let’s query the NASS API.</p>
<pre class="r"><code>#raw_result_nc_ag_land &lt;- GET(url = nass_url, path = path_nc_ag_land)</code></pre>
<p>We can check to see if it worked by looking at <code>status_code</code>. To read more about the different status codes and their meansing you can visit <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" class="uri">https://en.wikipedia.org/wiki/List_of_HTTP_status_codes</a>.</p>
<pre class="r"><code>#raw_result_nc_ag_land$status_code</code></pre>
<p>Great! We’re wanting to see status code 200 here. That means our query was requested and responded to. If we look at this in your RStudio session it will come in as a ‘Large resonse’ or in other words as a JSON object. For simplicity sake, we can think of this as a list of lists that we want to convert to something more usable in R. We’ll start by using <code>rawToChar()</code>. We can check the size and look at the first few characters.</p>
<pre class="r"><code>#char_raw_nc_ag_land &lt;- rawToChar(raw_result_nc_ag_land$content)

# check size of object
#nchar(char_raw_nc_ag_land)

# view first 100 characthers
#substr(char_raw_nc_ag_land, 1, 100)</code></pre>
<p>This is still a little hard to work with so let’s use <code>fromJSON()</code> and convert it to a large list and then a data frame.</p>
<pre class="r"><code>#list_raw_nc_ag_land &lt;- fromJSON(char_raw_nc_ag_land)

# view first element (it&#39;s big so we&#39;ll comment it here)
# list_raw_ag_land[[1]]

# convert to a data frame
#nc_ag_land_raw_data &lt;- do.call(what = &quot;rbind&quot;, args = lapply(list_raw_nc_ag_land, as.data.frame))

# look at the data frame
#head(nc_ag_land_raw_data)</code></pre>
<pre class="r"><code># nc_irrigated &lt;- nc_ag_land_raw_data %&gt;%
#   filter(domain_desc == &quot;AREA OPERATED&quot;) %&gt;%
#   filter(unit_desc == &quot;ACRES&quot;) %&gt;%
#   filter(agg_level_desc == &quot;COUNTY&quot;) %&gt;%
#   filter(domaincat_desc == &quot;AREA OPERATED: (1,000 TO 1,999 ACRES)&quot;) %&gt;%
#   mutate(value_trim = str_trim(Value)) %&gt;% # trim tab from non-numeric values
#   select(state_name, state_alpha, state_ansi, county_code, county_name, asd_desc,
#          agg_level_desc, year, prodn_practice_desc_char=prodn_practice_desc,
#          value_ac_per_yr_char=value_trim) %&gt;%
#   filter(value_ac_per_yr_char != &quot;(D)&quot; &amp; value_ac_per_yr_char != &quot;(Z)&quot;) %&gt;% # remove codes (D) = ?, (Z) = ?
#   mutate(value_ac_per_yr = as.numeric(str_remove(value_ac_per_yr_char, &quot;,&quot;))) %&gt;% #remove commas
#   select(-value_ac_per_yr_char) %&gt;%
#   mutate(prodn_practice_desc = str_replace_all(str_to_lower(prodn_practice_desc_char), &quot;[ ]&quot;, &quot;_&quot;)) %&gt;%
#   select(-prodn_practice_desc_char) %&gt;%
#   group_by(county_code) %&gt;%
#   filter(n()&gt;3) %&gt;%
#   group_by(county_code, year) %&gt;%
#   spread(prodn_practice_desc, value_ac_per_yr) %&gt;%
#   mutate(percent_irrigated_long = irrigated/all_production_practices*100) %&gt;%
#   mutate(GEOID = paste0(state_ansi, county_code))</code></pre>
<p>Some other thoughts that I wanted to mention before signing off:</p>
</div>

    </div>

    





    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

